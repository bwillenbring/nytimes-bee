name: Playwright Tests
on:
    workflow_dispatch:
    # push:
    #     branches: [main, master]
    # pull_request:
    #     branches: [main, master]
jobs:
    test:
        timeout-minutes: 5
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - uses: actions/setup-node@v2
              with:
                  node-version: '14.x'
            - name: Install dependencies
              run: npm ci

            - name: Install only chromium Playwright Browser
              run: npx playwright install chromium --with-deps

            - name: Run Cypress
              run: |
                  npx cypress run -s 'cypress/integration/02*' -e 'SQ_EMAIL=${{ secrets.SQ_EMAIL }},SQ_PASSWORD=${{ secrets.SQ_PASSWORD }},API_URL_T=${{ secrets.API_URL_T }},API_URL_D=${{ secrets.API_URL_D }},API_KEY_T=${{ secrets.API_KEY_T }},API_KEY_D=${{ secrets.API_KEY_D }}'

            - name: Run Playwright tests
              run: SS_PASSWORD='${{ secrets.SS_PASSWORD }}' SQ_EMAIL='${{ secrets.SQ_EMAIL }}' SQ_PASSWORD='${{ secrets.SQ_PASSWORD }}' API_URL_T='${{ secrets.API_URL_T }}' API_URL_D='${{ secrets.API_URL_D }}' API_KEY_T='${{ secrets.API_KEY_T }}' API_KEY_D='${{ secrets.API_KEY_D }}' npx playwright test squarespace
            - uses: actions/upload-artifact@v2
              if: always()
              with:
                  name: playwright-report
                  path: playwright-report/
                  retention-days: 1
